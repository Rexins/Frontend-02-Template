<div class="container">文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字 文字
文字 文字 文字 文字 文字 文字 </div>
<div id="dragable" style="display: inline-block;width: 100px; height: 100px; background-color: gray"></div>

<script>
  const dragableEl = document.getElementById('dragable')
  let baseX = 0, baseY = 0
  dragableEl.addEventListener('mousedown', e => {
    let startX = e.clientX, startY = e.clientY
    const up = (e) => {
      baseX = baseX + e.clientX - startX
      baseY = baseY + e.clientY - startY
      document.removeEventListener('mousemove', move)
      document.removeEventListener('mouseup', up)
    }
    const move = (e) => {
      const range = getNearest(e.clientX, e.clientY)
      // console.dir(range)
      range.insertNode(dragableEl)
      // dragableEl.style.transform = `translate3d(${baseX + e.clientX - startX}px, ${baseY + e.clientY - startY}px, 0)`
    }
    document.addEventListener('mousemove', move)
    document.addEventListener('mouseup', up)
  })

  let ranges = [];
  let container = document.getElementsByClassName('container')[0]

  for (let i = 0; i < container.childNodes[0].textContent.length; i++) {
    const range = document.createRange()
    range.setStart(container.childNodes[0], i)
    range.setEnd(container.childNodes[0], i)
    ranges.push(range)
  }

  function getNearest(x, y) {
    let min = Infinity
    let nearest = null

    for (let range of ranges) {
      const rect = range.getBoundingClientRect()
      let distance = (rect.x - x) ** 2 + (rect.y - y) ** 2

      if (distance < min) {
        min = distance
        nearest = range
      }
    }

    return nearest
  }

  document.addEventListener('selectstart', event => event.preventDefault())
</script>
